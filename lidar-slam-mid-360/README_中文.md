# LiDAR SLAM 演示系统

## 什么是SLAM？

SLAM（Simultaneous Localization and Mapping）是指**同时定位与建图**的技术。在未知环境中，机器人或设备需要：

1. **确定自己的位置**（Localization）
2. **构建周围环境的地图**（Mapping）

这两个过程是同时进行的、相互依赖的，这就是SLAM的核心思想。

## 系统组成

本系统使用Livox Mid360激光雷达实现室内SLAM，主要包含以下组件：

### 1. 激光雷达驱动 (`launch/msg_MID360_launch.py`)
- 启动Livox Mid360激光雷达
- 发布点云数据 (`/livox/lidar`) 和IMU数据 (`/livox/imu`)
- 点云频率：10Hz，视野范围：360°

### 2. SLAM算法 (`launch/mapping.launch.py`)
- 订阅激光雷达的点云和IMU数据
- 实时计算设备的位置和姿态
- 构建周围环境的3D点云地图
- 发布定位结果 (`/Odometry`) 和地图 (`/cloud_registered`)

### 3. 算法库源码 (`src/library/`)
- **激光雷达数据预处理** (`preprocess.cpp/h`)：点云去畸变、特征提取
- **IMU数据处理** (`IMU_Processing.hpp`)：惯性测量数据预积分
- **建图算法** (`laserMapping.cpp`)：实时建图和位姿优化
- **数学工具库** (`IKFoM_toolkit/`)：迭代卡尔曼滤波器实现
- **KD树库** (`ikd-Tree/`)：高效的空间点云管理

### 4. 配置文件 (`config/mid360.yaml`)
- 设置激光雷达参数（类型、扫描线数等）
- 配置IMU参数（噪声协方差等）
- 定义外部参数（雷达在IMU坐标系中的位置）
- 设置发布选项（路径、地图等）

## 代码结构说明

### 核心算法文件：
- **`laserMapping.cpp`**：主建图程序，实现SLAM核心算法
- **`preprocess.cpp/h`**：点云预处理，提取特征点
- **`IMU_Processing.hpp`**：IMU数据预处理和预积分

### 数学工具库：
- **`IKFoM_toolkit/`**：迭代扩展卡尔曼滤波器工具箱
  - 实现误差状态卡尔曼滤波
  - 处理非线性系统状态估计
- **`ikd-Tree/`**：增量KD树库
  - 高效管理动态点云数据
  - 支持快速最近邻搜索

### 辅助工具：
- **`so3_math.h`**：SO(3)群数学运算（旋转矩阵）
- **`Exp_mat.h`**：指数映射和对数映射
- **`common_lib.h`**：通用数学函数库

## SLAM基本原理

### 数据流：
```
激光雷达 → 点云数据 → SLAM算法 → 位姿估计 + 地图构建
   ↑                              ↓
IMU数据 ←————————————— 传感器融合 ———————————————
```

### 核心步骤：
1. **传感器融合**：结合激光雷达点云和IMU惯性测量数据
2. **特征提取**：从点云中提取稳定的几何特征（如边缘、平面）
3. **位姿估计**：根据特征匹配计算设备运动
4. **地图更新**：将新的点云数据融合到全局地图中

### 关键概念：
- **点云**：激光雷达扫描到的3D空间点集合
- **位姿**：设备的位置和朝向（6自由度：x,y,z,roll,pitch,yaw）
- **里程计**：通过传感器数据估算的相对运动
- **地图**：累积构建的环境几何表示

## 运行方式

```bash
# 1. 编译算法库（如果需要修改源码）
cd src/library
catkin_make  # 或 colcon build（ROS2）

# 2. 启动激光雷达驱动
ros2 launch livox_ros_driver2 msg_MID360_launch.py

# 3. 启动SLAM算法（新终端）
ros2 launch fast_lio mapping.launch.py config_file:=mid360.yaml
```

## 观察结果

启动后可以在RViz中观察：
- **彩色点云**：实时扫描的激光雷达数据
- **轨迹路径**：设备运动的路径
- **全局地图**：累积构建的3D环境地图

## 应用场景

- 室内机器人导航
- 建筑物3D扫描
- 无人机室内定位
- 自动驾驶室内测试

## 注意事项

- 确保激光雷达正确连接并供电
- 室内环境光线充足，避免阳光直射
- 移动时保持匀速，避免剧烈运动
- 定期保存地图数据以避免丢失
